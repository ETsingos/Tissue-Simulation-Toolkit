\doxysection{x11graph.\+hpp}
\hypertarget{x11graph_8hpp_source}{}\label{x11graph_8hpp_source}\index{/Users/koenkeijzer/Documents/CPM/Tissue-\/Simulation-\/Toolkit/src/graphics/x11graph.hpp@{/Users/koenkeijzer/Documents/CPM/Tissue-\/Simulation-\/Toolkit/src/graphics/x11graph.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{00002\ \textcolor{comment}{Copyright\ 1995-\/2006\ Roeland\ Merks,\ Maarten\ Boerlijst\ (probably)}}
\DoxyCodeLine{00003\ \textcolor{comment}{This\ file\ is\ part\ of\ Tissue\ Simulation\ Toolkit.}}
\DoxyCodeLine{00004\ \textcolor{comment}{Tissue\ Simulation\ Toolkit\ is\ free\ software;\ you\ can\ redistribute}}
\DoxyCodeLine{00005\ \textcolor{comment}{it\ and/or\ modify\ it\ under\ the\ terms\ of\ the\ GNU\ General\ Public}}
\DoxyCodeLine{00006\ \textcolor{comment}{License\ as\ published\ by\ the\ Free\ Software\ Foundation;\ either}}
\DoxyCodeLine{00007\ \textcolor{comment}{version\ 2\ of\ the\ License,\ or\ (at\ your\ option)\ any\ later\ version.}}
\DoxyCodeLine{00008\ \textcolor{comment}{Tissue\ Simulation\ Toolkit\ is\ distributed\ in\ the\ hope\ that\ it\ will}}
\DoxyCodeLine{00009\ \textcolor{comment}{be\ useful,\ but\ WITHOUT\ ANY\ WARRANTY;\ without\ even\ the\ implied}}
\DoxyCodeLine{00010\ \textcolor{comment}{warranty\ of\ MERCHANTABILITY\ or\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE.}}
\DoxyCodeLine{00011\ \textcolor{comment}{See\ the\ GNU\ General\ Public\ License\ for\ more\ details.}}
\DoxyCodeLine{00012\ \textcolor{comment}{You\ should\ have\ received\ a\ copy\ of\ the\ GNU\ General\ Public\ License}}
\DoxyCodeLine{00013\ \textcolor{comment}{along\ with\ Tissue\ Simulation\ Toolkit;\ if\ not,\ write\ to\ the\ Free}}
\DoxyCodeLine{00014\ \textcolor{comment}{Software\ Foundation,\ Inc.,\ 51\ Franklin\ St,\ Fifth\ Floor,\ Boston,\ MA}}
\DoxyCodeLine{00015\ \textcolor{comment}{02110-\/1301\ USA}}
\DoxyCodeLine{00016\ \textcolor{comment}{*/}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{comment}{//\ This\ graphics\ code\ derives\ from\ C\ code\ circulating\ in\ Utrecht}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ UniversityÂ´s\ Theoretical\ Biology\ group\ around\ 1995,\ which\ was}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ (probably)\ written\ by\ Maarten\ Boerlijst}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}inputoutput.hpp"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}parameter.hpp"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}sticky.hpp"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}x11graph.hpp"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <X11/Xlib.h>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <X11/Xutil.h>}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <X11/cursorfont.h>}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ <X11/keysym.h>}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <cstring>}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <errno.h>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <fcntl.h>}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ <iostream>}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ <malloc.h>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <math.h>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <png.h>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ <string>}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ <sys/stat.h>}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ <sys/types.h>}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keyword}{extern}\ \mbox{\hyperlink{class_parameter}{Parameter}}\ par;}
\DoxyCodeLine{00045\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ errno;}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{using\ namespace\ }std;}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ X11Graphics::X11Graphics(\textcolor{keywordtype}{int}\ xsize,\ \textcolor{keywordtype}{int}\ ysize,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *movie\_file)}
\DoxyCodeLine{00050\ \ \ \ \ :\ \mbox{\hyperlink{class_graphics}{Graphics}}()\ \{}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ initialisation\ of\ data\ members}}
\DoxyCodeLine{00053\ \ \ count\ =\ 0;}
\DoxyCodeLine{00054\ \ \ title\ =\ strdup(\textcolor{stringliteral}{"{}Cellular\ Potts"{}});}
\DoxyCodeLine{00055\ \ \ server\ =\ 0;}
\DoxyCodeLine{00056\ \ \ display\ =\ 0;}
\DoxyCodeLine{00057\ \ \ visual\_list\ =\ 0;}
\DoxyCodeLine{00058\ \ \ colors\ =\ 0;}
\DoxyCodeLine{00059\ \ \ xfield\ =\ xsize;}
\DoxyCodeLine{00060\ \ \ yfield\ =\ ysize;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ pseudoCol8\ =\ 1;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ old\_window\_name\ =\ 0;}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ X11Graphics\ Initialisation}}
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ Open\ window,\ etc.}}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)}
\DoxyCodeLine{00069\ \ \ \ \ InitGraphics(xfield,\ yfield);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (par.store)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{if}\ (movie\_file)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ movie\_file\_name\ =\ strdup(movie\_file);}
\DoxyCodeLine{00074\ \ \ \ \ \ \ store\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00075\ \ \ \ \ \ \ InitStore();}
\DoxyCodeLine{00076\ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ store\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ NB\ dropped\ default\ movie\ name\ "{}showbeast.mov"{}}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ No\ movie\ name\ given,\ no\ movie\ written.}}
\DoxyCodeLine{00080\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00081\ \ \ \ \ store\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00082\ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{comment}{//\ movie\ data\ will\ also\ be\ used\ for\ writing\ images}}
\DoxyCodeLine{00085\ \ \ movie\_data\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}));}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ X11Graphics::\string~X11Graphics(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ CloseGraphics();}
\DoxyCodeLine{00091\ \ \ free(title);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (store)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ free(film);}
\DoxyCodeLine{00095\ \ \ \}}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (store)}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{if}\ (compressed\_movie\_p)}
\DoxyCodeLine{00098\ \ \ \ \ \ \ pclose(movie\_fp);}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00100\ \ \ \ \ \ \ fclose(movie\_fp);}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_x11_graphics_af90168e2537eb714dd0d916a2c543f74}{X11Graphics::BeginScene}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00104\ \ \ \textcolor{comment}{//\ nothing}}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_x11_graphics_aeafb2bf394ef9dfd3aa9b390d2b21d7a}{X11Graphics::EndScene}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{if}\ (shm)\ \{\ \textcolor{comment}{//\ shared\ memory\ extension\ available?}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ XShmPutImage(display,\ window,\ windowGC,\ image,\ 0,\ 0,\ 0,\ 0,\ image-\/>width,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image-\/>height,\ 0);}
\DoxyCodeLine{00113\ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00114\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00115\ \ \ \ \ \ \ XPutImage(display,\ window,\ windowGC,\ image,\ 0,\ 0,\ 0,\ 0,\ image-\/>width,}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ image-\/>height);}
\DoxyCodeLine{00117\ \ \ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}\ thetime\ =\ 0;}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{if}\ (store\ \&\&\ !(thetime++\ \%\ par.storage\_stride))}
\DoxyCodeLine{00121\ \ \ \ \ StoreCompPict();}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \textcolor{preprocessor}{\#define\ NOPVM}}
\DoxyCodeLine{00125\ \textcolor{preprocessor}{\#ifndef\ NOPVM}}
\DoxyCodeLine{00126\ \textcolor{keywordtype}{void}\ X11Graphics::SendScene()\ \{\ SendPicture(image\_data,\ xfield,\ yfield);\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \textcolor{keywordtype}{void}\ X11Graphics::ReceiveScene(\textcolor{keywordtype}{int}\ machineindex,\ \textcolor{keywordtype}{int}\ beastindex,\ \textcolor{keywordtype}{int}\ ndish)\ \{}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{keywordtype}{int}\ sizex,\ sizey;}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{char}\ *picture;}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordtype}{int}\ xpos,\ ypos;}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordtype}{int}\ i,\ j;}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordtype}{int}\ xdim;}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{/*\ \ ComputeDimensions(\&xdim,\&ydim);\ */}}
\DoxyCodeLine{00137\ \ \ xdim\ =\ (int)(sqrt((\textcolor{keywordtype}{float})(ndish)-\/1.))\ +\ 1;}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{/*\ Receive\ the\ picture\ */}}
\DoxyCodeLine{00140\ \ \ picture\ =\ ReceivePicture(\&sizex,\ \&sizey,\ machineindex);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{/*\ position\ of\ this\ scene\ in\ the\ big\ picture\ */}}
\DoxyCodeLine{00143\ \ \ xpos\ =\ (beastindex\ \%\ xdim)\ *\ sizex;}
\DoxyCodeLine{00144\ \ \ ypos\ =\ (beastindex\ /\ xdim)\ *\ sizey;}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ printf(\textcolor{stringliteral}{"{}xp:\ \%d,\ yp:\ \%d\(\backslash\)n"{}},\ xpos,\ ypos);}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \textcolor{comment}{/*\ Copy\ the\ picture\ in\ the\ display\ window\ */}}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ sizex;\ i++)}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ sizey;\ j++)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pseudoCol8)}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ image\_data[xpos\ +\ i\ +\ xdim\ *\ sizey\ *\ (ypos\ +\ j)]\ =}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ picture[j\ +\ i\ *\ sizex];}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ XPutPixel(image,\ xpos\ +\ i,\ ypos\ +\ j,}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ colors[picture[j\ +\ i\ *\ sizex]].pixel);}
\DoxyCodeLine{00157\ \ \ \ \ \}}
\DoxyCodeLine{00158\ \ \ \textcolor{comment}{/*\ And\ redraw\ the\ window\ ....\ */}}
\DoxyCodeLine{00159\ \ \ DrawScene();}
\DoxyCodeLine{00160\ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \textcolor{keywordtype}{void}\ X11Graphics::ReceiveScene1(\textcolor{keywordtype}{int}\ machineindex,\ \textcolor{keywordtype}{int}\ beastindex,\ \textcolor{keywordtype}{int}\ ndish)\ \{}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{keywordtype}{int}\ sizex,\ sizey;}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordtype}{char}\ *picture;}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordtype}{int}\ xpos,\ ypos;}
\DoxyCodeLine{00167\ \ \ \textcolor{keywordtype}{int}\ i,\ j;}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{comment}{/*\ Receive\ the\ picture\ */}}
\DoxyCodeLine{00170\ \ \ picture\ =\ ReceivePicture(\&sizex,\ \&sizey,\ machineindex);}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{/*\ position\ of\ this\ scene\ in\ the\ big\ picture\ */}}
\DoxyCodeLine{00173\ \ \ xpos\ =\ 0;}
\DoxyCodeLine{00174\ \ \ ypos\ =\ 0;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{/*\ Copy\ the\ picture\ in\ the\ display\ window\ */}}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ sizex;\ i++)}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ sizey;\ j++)}
\DoxyCodeLine{00179\ \ \ \ \ \ \ image\_data[xpos\ +\ i\ +\ sizey\ *\ (ypos\ +\ j)]\ =\ picture[j\ +\ i\ *\ sizex];}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{/*\ And\ redraw\ the\ window\ ....\ */}}
\DoxyCodeLine{00182\ \ \ DrawScene();}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{keywordtype}{void}\ X11Graphics::ReadColorTable(XColor\ *cols)\ \{}
\DoxyCodeLine{00187\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordtype}{int}\ p,\ q,\ r;}
\DoxyCodeLine{00189\ \ \ \textcolor{keywordtype}{char}\ name[50];}
\DoxyCodeLine{00190\ \ \ FILE\ *fpc;}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ sprintf(name,\ \textcolor{stringliteral}{"{}default.ctb"{}});}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{if}\ ((fpc\ =\ fopen(name,\ \textcolor{stringliteral}{"{}r"{}}))\ ==\ NULL)\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordtype}{char}\ *message\ =\ (\textcolor{keywordtype}{char}\ *)malloc(200\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{if}\ (message\ ==\ 0)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{stringliteral}{"{}Memory\ panic\ in\ X11Graphics::ReadColorTable\(\backslash\)n"{}};}
\DoxyCodeLine{00197\ \ \ \ \ \}}
\DoxyCodeLine{00198\ \ \ \ \ snprintf(message,\ 199,}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}X11Graphics::ReadColorTable:\ Colormap\ '\%s'\ not\ found."{}},\ name);}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ cerr\ <<\ message\ <<\ endl;}}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordflow}{throw}(message);}
\DoxyCodeLine{00202\ \ \ \}}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{while}\ (fscanf(fpc,\ \textcolor{stringliteral}{"{}\%d"{}},\ \&i)\ !=\ EOF)\ \{}
\DoxyCodeLine{00204\ \ \ \ \ fscanf(fpc,\ \textcolor{stringliteral}{"{}\%d\ \%d\ \%d\(\backslash\)n"{}},\ \&p,\ \&q,\ \&r);}
\DoxyCodeLine{00205\ \ \ \ \ cols[i].red\ =\ p\ *\ 255;}
\DoxyCodeLine{00206\ \ \ \ \ cols[i].green\ =\ q\ *\ 255;}
\DoxyCodeLine{00207\ \ \ \ \ cols[i].blue\ =\ r\ *\ 255;}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ \ \ fclose(fpc);}
\DoxyCodeLine{00210\ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \textcolor{keywordtype}{void}\ X11Graphics::MakeColorMap()\ \{}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordtype}{int}\ i,\ colormap\_size;}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \textcolor{comment}{//\ colormap\_size\ =\ DisplayCells(display,\ screen);}}
\DoxyCodeLine{00216\ \ \ colormap\_size\ =\ 256;}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ ((colors\ =\ (XColor\ *)malloc(colormap\_size\ *\ \textcolor{keyword}{sizeof}(XColor)))\ ==\ NULL)\ \{}
\DoxyCodeLine{00219\ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}No\ memory\ for\ setting\ up\ colormap\(\backslash\)n"{}});}
\DoxyCodeLine{00220\ \ \ \ \ exit(1);}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ colormap\_size;\ i++)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ colors[i].pixel\ =\ i;}
\DoxyCodeLine{00224\ \ \ \ \ colors[i].flags\ =\ DoRed\ |\ DoGreen\ |\ DoBlue;}
\DoxyCodeLine{00225\ \ \ \}}
\DoxyCodeLine{00226\ \ \ XQueryColors(display,\ DefaultColormap(display,\ screen),\ colors,}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ colormap\_size);}
\DoxyCodeLine{00228\ \ \ ReadColorTable(colors);}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordflow}{if}\ (pseudoCol8)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ new\_colormap\ =\ XCreateColormap(display,\ RootWindow(display,\ screen),}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DefaultVisual(display,\ screen),\ AllocAll);}
\DoxyCodeLine{00232\ \ \ \ \ XStoreColors(display,\ new\_colormap,\ colors,\ colormap\_size);}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ free(colors);}}
\DoxyCodeLine{00234\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00235\ \ \ \ \ new\_colormap\ =\ XDefaultColormap(display,\ screen);}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <=\ 255\ \&\&\ i\ <\ colormap\_size;\ i++)}
\DoxyCodeLine{00237\ \ \ \ \ \ \ XAllocColor(display,\ new\_colormap,\ \&colors[i]);}
\DoxyCodeLine{00238\ \ \ \}}
\DoxyCodeLine{00239\ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{class_x11_graphics_a2d3f6a3d4b3f0131dbfb9253d51f0ebc}{X11Graphics::GetXYCoo}}(\textcolor{keywordtype}{int}\ *X,\ \textcolor{keywordtype}{int}\ *Y)\ \{}
\DoxyCodeLine{00242\ \textcolor{preprocessor}{\#define\ KEYBUFSIZE\ 10}}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordtype}{char}\ keybuffer[KEYBUFSIZE];}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordtype}{int}\ bufsize\ =\ KEYBUFSIZE;}
\DoxyCodeLine{00245\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ oldwidth\ =\ 0,\ oldheight\ =\ 0;}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ KeySym\ key;}
\DoxyCodeLine{00248\ \ \ XComposeStatus\ cs;}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{/*\ initialise\ oldwidth\ and\ oldheight\ */}}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordflow}{if}\ (oldwidth\ ==\ 0\ \&\&\ oldheight\ ==\ 0)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ di;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ dui;}
\DoxyCodeLine{00256\ \ \ \ \ \ \ Window\ dw;}
\DoxyCodeLine{00257\ \ \ \ \ \ \ XGetGeometry(display,\ window,\ \&dw,\ \&di,\ \&di,\ \&oldwidth,\ \&oldheight,\ \&dui,}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&dui);}
\DoxyCodeLine{00259\ \ \ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordflow}{while}\ (XEventsQueued(display,\ QueuedAfterFlush)\ >\ 0)\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ XNextEvent(display,\ \&event);}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (event.xany.window\ ==\ window)}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (event.type)\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Expose:}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_aeafb2bf394ef9dfd3aa9b390d2b21d7a}{EndScene}}();}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ KeyPress:}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ XLookupString(\&event.xkey,\ keybuffer,\ bufsize,\ \&key,\ \&cs);}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})keybuffer[0];}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ MotionNotify:}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ *X\ =\ \textcolor{keyword}{event}.xmotion.x;}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ *Y\ =\ \textcolor{keyword}{event}.xmotion.y;}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ MOTION;}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonPress:}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ *X\ =\ \textcolor{keyword}{event}.xbutton.x;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ *Y\ =\ \textcolor{keyword}{event}.xbutton.y;}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (event.xbutton.button)\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Button1:}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Button2:}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Button3:}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 3;}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ConfigureNotify:}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})event.xconfigure.width\ !=\ oldwidth\ ||}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})event.xconfigure.height\ !=\ oldheight)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ *X\ =\ \textcolor{keyword}{event}.xconfigure.width;}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ *Y\ =\ \textcolor{keyword}{event}.xconfigure.height;}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ oldwidth\ =\ *X;}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ oldheight\ =\ *Y;}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ Resize();}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ RESIZE;}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00307\ \ \ \ \ \}}
\DoxyCodeLine{00308\ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00311\ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{keywordtype}{int}\ X11Graphics::XExposep()\ \{}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{if}\ (event.xany.window\ ==\ window)}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (event.type)\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Expose:}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (event.xexpose.count\ ==\ 0)}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ TRUE;}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ else:\ go\ on\ and\ return\ FALSE\ */}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ FALSE;}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{return}\ FALSE;}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \textcolor{keywordtype}{int}\ X11Graphics::GetHeight(Window\ w)\ \{}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordtype}{int}\ di;}
\DoxyCodeLine{00336\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ dui;}
\DoxyCodeLine{00337\ \ \ Window\ dw;}
\DoxyCodeLine{00338\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ height;}
\DoxyCodeLine{00339\ \ \ XGetGeometry(display,\ w,\ \&dw,\ \&di,\ \&di,\ \&dui,\ \&height,\ \&dui,\ \&dui);}
\DoxyCodeLine{00340\ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})height;}
\DoxyCodeLine{00341\ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \textcolor{keywordtype}{char}\ *\mbox{\hyperlink{class_x11_graphics_adcce6fa1eab8d9a059333e9b1cc8580e}{X11Graphics::ChangeTitle}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *message)\ \{}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \textcolor{comment}{/*\ Change\ name\ of\ window:\ */}}
\DoxyCodeLine{00346\ \ \ \textcolor{keywordflow}{if}\ (!XFetchName(display,\ window,\ \&old\_window\_name))\ \{}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{comment}{/*\ Window's\ name\ fetch\ unsuccessful,\ write\ message\ to\ terminal.\ */}}
\DoxyCodeLine{00349\ \ \ \ \ fprintf(stdout,\ \textcolor{stringliteral}{"{}\%s\(\backslash\)n"{}},\ message);}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{comment}{/*\ Write\ message\ in\ window\ title\ */}}
\DoxyCodeLine{00354\ \ \ \ \ XStoreName(display,\ window,\ message);}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ XFlush(display);}
\DoxyCodeLine{00358\ \ \ \textcolor{keywordflow}{return}\ old\_window\_name;}
\DoxyCodeLine{00359\ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_x11_graphics_a6b8fc3f7590a2f9ae5be1a3917b28cce}{X11Graphics::RecoverTitle}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \textcolor{keywordflow}{if}\ (old\_window\_name)\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_adcce6fa1eab8d9a059333e9b1cc8580e}{ChangeTitle}}(old\_window\_name);}
\DoxyCodeLine{00365\ \ \ \ \ free(old\_window\_name);}
\DoxyCodeLine{00366\ \ \ \ \ old\_window\_name\ =\ 0;}
\DoxyCodeLine{00367\ \ \ \}}
\DoxyCodeLine{00368\ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \textcolor{keywordtype}{void}\ X11Graphics::InitGraphics(\textcolor{keywordtype}{int}\ xsize,\ \textcolor{keywordtype}{int}\ ysize)\ \{}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordtype}{char}\ **argv\ =\ 0;}
\DoxyCodeLine{00372\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00373\ \ \ hsize\ =\ xfield\ =\ xsize;}
\DoxyCodeLine{00374\ \ \ vsize\ =\ yfield\ =\ ysize;}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keywordflow}{if}\ (!display)}
\DoxyCodeLine{00378\ \ \ \ \ \ \ display\ =\ XOpenDisplay(server);}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{keywordflow}{if}\ (!display)\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Failed\ to\ open\ display\ connection\ to\ \%s\(\backslash\)n"{}},\ XDisplayName(server));}
\DoxyCodeLine{00381\ \ \ \ \ \ \ exit(0);}
\DoxyCodeLine{00382\ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \ screen\ =\ DefaultScreen(display);}
\DoxyCodeLine{00384\ \ \ \ \ visual\_info.screen\ =\ screen;}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keywordflow}{if}\ (!visual\_list)}
\DoxyCodeLine{00386\ \ \ \ \ \ \ visual\_list\ =\ XGetVisualInfo(display,\ VisualScreenMask,\ \&visual\_info,\ \&i);}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{if}\ (pseudoCol8\ \&\&}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ XMatchVisualInfo(display,\ screen,\ 8,\ PseudoColor,\ \&visual\_info))\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ visual\ =\ visual\_info.visual;}
\DoxyCodeLine{00391\ \ \ \ \ \ \ depth\ =\ visual\_info.depth;}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (VERBOSE)}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Got\ PseudoColor\ with\ Depth\ \%d\(\backslash\)n"{}},\ depth);}
\DoxyCodeLine{00394\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ pseudoCol8\ =\ 0;}
\DoxyCodeLine{00396\ \ \ \ \ \ \ visual\ =\ XDefaultVisual(display,\ screen);}
\DoxyCodeLine{00397\ \ \ \ \ \ \ depth\ =\ XDefaultDepth(display,\ screen);}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (VERBOSE)}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Got\ default\ Visual\ with\ Depth\ \%d\(\backslash\)n"{}},\ depth);}
\DoxyCodeLine{00400\ \ \ \ \ \}}
\DoxyCodeLine{00401\ \ \ \ \ colourclass\ =\ visual-\/>c\_class;}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\ ==\ 1)}
\DoxyCodeLine{00403\ \ \ \ \ \ \ color\_screen\ =\ 0;}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (colourclass\ ==\ GrayScale)}
\DoxyCodeLine{00405\ \ \ \ \ \ \ color\_screen\ =\ 0;}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (colourclass\ ==\ PseudoColor)}
\DoxyCodeLine{00407\ \ \ \ \ \ \ color\_screen\ =\ 1;}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (colourclass\ ==\ DirectColor)}
\DoxyCodeLine{00409\ \ \ \ \ \ \ color\_screen\ =\ 1;}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (colourclass\ ==\ TrueColor)}
\DoxyCodeLine{00411\ \ \ \ \ \ \ color\_screen\ =\ 1;}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (colourclass\ ==\ StaticColor)}
\DoxyCodeLine{00413\ \ \ \ \ \ \ color\_screen\ =\ 1;}
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (colourclass\ ==\ StaticGray)}
\DoxyCodeLine{00415\ \ \ \ \ \ \ color\_screen\ =\ 1;}
\DoxyCodeLine{00416\ \ \ \ \ hint.x\ =\ 0;}
\DoxyCodeLine{00417\ \ \ \ \ hint.y\ =\ 0;}
\DoxyCodeLine{00418\ \ \ \ \ hint.width\ =\ hsize;}
\DoxyCodeLine{00419\ \ \ \ \ hint.height\ =\ vsize;}
\DoxyCodeLine{00420\ \ \ \ \ hint.min\_width\ =\ xfield;}
\DoxyCodeLine{00421\ \ \ \ \ hint.min\_height\ =\ yfield;}
\DoxyCodeLine{00422\ \ \ \ \ hint.flags\ =\ PPosition\ |\ PSize\ |\ PMinSize;}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keywordflow}{if}\ (!colors)}
\DoxyCodeLine{00425\ \ \ \ \ \ \ MakeColorMap();}
\DoxyCodeLine{00426\ \ \ \ \ black\ =\ BlackPixel(display,\ screen);}
\DoxyCodeLine{00427\ \ \ \ \ white\ =\ WhitePixel(display,\ screen);}
\DoxyCodeLine{00428\ \ \ \ \ background\ =\ white;}
\DoxyCodeLine{00429\ \ \ \ \ foreground\ =\ black;}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \ \ setattributes.colormap\ =\ new\_colormap;}
\DoxyCodeLine{00432\ \ \ \ \ setattributes.background\_pixel\ =\ WhitePixel(display,\ screen);}
\DoxyCodeLine{00433\ \ \ \ \ background\ =\ 0;}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \ \ setattributes.border\_pixel\ =\ BlackPixel(display,\ screen);}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ window\ =}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ XCreateWindow(display,\ DefaultRootWindow(display),\ hint.x,\ hint.y,}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hint.width,\ hint.height,\ 5,\ depth,\ InputOutput,\ visual,}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CWColormap\ |\ CWBackPixel\ |\ CWBorderPixel,\ \&setattributes);}
\DoxyCodeLine{00441\ \ \ \ \ XSetStandardProperties(display,\ window,\ title,\ title,\ None,\ argv,\ 0,\ \&hint);}
\DoxyCodeLine{00442\ \ \ \ \ XGetWindowAttributes(display,\ window,\ \&attributes);}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \textcolor{keywordflow}{if}\ (DoesBackingStore(DefaultScreenOfDisplay(display)))\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \ \ setattributes.backing\_store\ =\ WhenMapped;}
\DoxyCodeLine{00446\ \ \ \ \ \ \ XChangeWindowAttributes(display,\ window,\ CWBackingStore,\ \&setattributes);}
\DoxyCodeLine{00447\ \ \ \ \ \}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ windowGC\ =\ XCreateGC(display,\ window,\ 0,\ 0);}
\DoxyCodeLine{00450\ \ \ \ \ XSetBackground(display,\ windowGC,\ background);}
\DoxyCodeLine{00451\ \ \ \ \ XSetForeground(display,\ windowGC,\ foreground);}
\DoxyCodeLine{00452\ \ \ \ \ XSetLineAttributes(display,\ windowGC,\ 1,\ LineSolid,\ CapRound,\ JoinRound);}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ XSelectInput(display,\ window,}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ButtonPressMask\ |\ ExposureMask\ |\ KeyPressMask\ |}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ StructureNotifyMask);}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ XMapRaised(display,\ window);}
\DoxyCodeLine{00459\ \ \ \ \ XNextEvent(display,\ \&event);}
\DoxyCodeLine{00460\ \ \ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \textcolor{comment}{//\ Try\ to\ attach\ to\ shared\ memory}}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00465\ \ \ \textcolor{keywordflow}{if}\ (XShmQueryExtension(display))\ \{}
\DoxyCodeLine{00466\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Shared\ memory\ extension\ will\ be\ used\(\backslash\)n"{}});}
\DoxyCodeLine{00467\ \ \ \ \ shm\ =\ 1;}
\DoxyCodeLine{00468\ \ \ \}}
\DoxyCodeLine{00469\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00470\ \ \ \textcolor{comment}{//\ shm=0;}}
\DoxyCodeLine{00471\ \ \ printf(\textcolor{stringliteral}{"{}store\ \%d,\ graphics\ \%d\(\backslash\)n"{}},\ store,\ par.graphics);}
\DoxyCodeLine{00472\ \ \ printf(\textcolor{stringliteral}{"{}depth/8\ =\ \%d\(\backslash\)n"{}},\ depth\ /\ 8);}
\DoxyCodeLine{00473\ \ \ \textcolor{keywordflow}{if}\ (pseudoCol8)\ \{}
\DoxyCodeLine{00474\ \ \ \ \ image\_data\ =\ (\textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00475\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ xfield\ *\ yfield;\ i++)\ \{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ image\_data[i]\ =\ 1;}
\DoxyCodeLine{00477\ \ \ \ \ \}}
\DoxyCodeLine{00478\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{comment}{//\ True\ color\ visuals}}
\DoxyCodeLine{00480\ \ \ \ \ image\_data\ =\ (\textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})\ *\ 6);}
\DoxyCodeLine{00481\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ xfield\ *\ yfield\ *\ 6;\ i++)\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ image\_data[i]\ =\ 1;}
\DoxyCodeLine{00483\ \ \ \ \ \}}
\DoxyCodeLine{00484\ \ \ \}}
\DoxyCodeLine{00485\ \ \ \textcolor{comment}{//\ \ if\ (pseudoCol8)\ \{}}
\DoxyCodeLine{00486\ \ \ \textcolor{comment}{//\ \ movie\_data=image\_data;}}
\DoxyCodeLine{00487\ \ \ \textcolor{comment}{//\}\ else\ \{}}
\DoxyCodeLine{00488\ \ \ \textcolor{comment}{//\}}}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{if}\ (image\_data\ ==\ NULL)}
\DoxyCodeLine{00490\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ in\ memory\ allocation\(\backslash\)n"{}});}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{if}\ (graphics\ \&\&\ shm)\ \{}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \ \ image\ =\ XShmCreateImage(display,\ visual,\ depth,\ ZPixmap,\ NULL,\ \&shminfo,}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xfield,\ yfield);}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{comment}{//\ Allocate\ shared\ memory}}
\DoxyCodeLine{00498\ \ \ \ \ shminfo.shmid\ =\ shmget(IPC\_PRIVATE,\ image-\/>bytes\_per\_line\ *\ image-\/>height,}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IPC\_CREAT\ |\ 0777);}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{comment}{//\ Attach\ the\ shared\ memory\ segment\ to\ the\ process}}
\DoxyCodeLine{00502\ \ \ \ \ shminfo.shmaddr\ =\ image-\/>data\ =\ shmat(shminfo.shmid,\ 0,\ 0);}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{comment}{//\ Reading\ and\ writing\ to\ the\ shm\ will\ be\ made\ possible}}
\DoxyCodeLine{00505\ \ \ \ \ shminfo.readOnly\ =\ False;}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keywordflow}{if}\ (!XShmAttach(display,\ \&shminfo))\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Warning:\ shared\ memory\ extension\ is\ available,\ but\ allocation\ of\ "{}}}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n\ shared\ memory\ segment\ failed...\ Reverting\ to\ private\ memory.\ "{}}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n\ This\ is\ not\ problematic,\ but\ it\ will\ be\ a\ bit\ slower.\(\backslash\)n"{}});}
\DoxyCodeLine{00511\ \ \ \ \ \ \ shm\ =\ 0;}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Successfully\ prepared\ for\ using\ shared\ memory.\(\backslash\)n"{}});}
\DoxyCodeLine{00516\ \ \ \ \ \}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ Shared\ memory\ is\ unavailable}}
\DoxyCodeLine{00519\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{keywordflow}{if}\ (pseudoCol8)\ \{}
\DoxyCodeLine{00522\ \ \ \ \ \ \ image\_data\ =\ (\textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00523\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \textcolor{comment}{//\ True\ color\ visuals}}
\DoxyCodeLine{00525\ \ \ \ \ \ \ image\_data\ =\ (\textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})\ *\ 6);}
\DoxyCodeLine{00526\ \ \ \ \ \}}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{keywordflow}{if}\ (image\_data\ ==\ NULL)\ \{}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Error\ in\ memory\ allocation\(\backslash\)n"{}});}
\DoxyCodeLine{00530\ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00531\ \ \ \ \ \}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{comment}{//\ Create\ XImage\ structure}}
\DoxyCodeLine{00534\ \ \ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00535\ \ \ \ \ \ \ image\ =\ XCreateImage(display,\ visual,\ depth,\ ZPixmap,\ 0,\ image\_data,}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xfield,\ yfield,\ 8,\ 0);}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ image}}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ xfield;\ x++)\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ yfield;\ y++)\ \{}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ XPutPixel(image,\ x,\ y,\ colors[0].pixel);}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00543\ \ \ \ \ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00546\ \ \ \}}
\DoxyCodeLine{00547\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ \textcolor{comment}{//\ Wait\ for\ MapNotify\ event}}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \textcolor{keywordflow}{for}\ (;;)\ \{}
\DoxyCodeLine{00552\ \ \ \ \ XEvent\ e;}
\DoxyCodeLine{00553\ \ \ \ \ XNextEvent(display,\ \&e);}
\DoxyCodeLine{00554\ \ \ \ \ \textcolor{keywordflow}{if}\ (e.type\ ==\ MapNotify)}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00556\ \ \ \}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ printf(\textcolor{stringliteral}{"{}MapNotify\ Event\ passed\(\backslash\)n"{}});}
\DoxyCodeLine{00559\ \}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \textcolor{keywordtype}{void}\ X11Graphics::CloseGraphics()\ \{}
\DoxyCodeLine{00562\ \ \ \textcolor{comment}{/*\ Free\ the\ memory\ that\ was\ allocated\ in\ InitGraphics\ */}}
\DoxyCodeLine{00563\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00564\ \ \ \ \ XClearWindow(display,\ window);}
\DoxyCodeLine{00565\ \ \ \ \ XDestroyImage(image);}
\DoxyCodeLine{00566\ \ \ \}}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00569\ \ \ \ \ XFreeGC(display,\ windowGC);}
\DoxyCodeLine{00570\ \ \ \ \ XDestroyWindow(display,\ window);}
\DoxyCodeLine{00571\ \ \ \ \ XCloseDisplay(display);}
\DoxyCodeLine{00572\ \ \ \}}
\DoxyCodeLine{00573\ \}}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_x11_graphics_aac47663836332028e6a382af6a2c622c}{X11Graphics::Point}}(\textcolor{keywordtype}{int}\ \mbox{\hyperlink{structcolor}{color}},\ \textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y)\ \{}
\DoxyCodeLine{00576\ \ \ \textcolor{comment}{//\ The\ following\ is\ not\ necessary\ for\ 8-\/bits\ graphics}}
\DoxyCodeLine{00577\ \ \ \textcolor{comment}{//\ therefore\ I\ commented\ it\ out.}}
\DoxyCodeLine{00578\ \ \ \textcolor{comment}{//\ if\ (pseudoCol8)\ \{}}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \textcolor{comment}{//\ \ (image\_data)[i+j*xfield]\ =\ (char)color;}}
\DoxyCodeLine{00581\ \ \ \textcolor{comment}{//\}\ else\ \{}}
\DoxyCodeLine{00582\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}\ <\ 0)}
\DoxyCodeLine{00583\ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}\ =\ 0;}
\DoxyCodeLine{00584\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)}
\DoxyCodeLine{00585\ \ \ \ \ XPutPixel(image,\ x,\ y,\ colors[\mbox{\hyperlink{structcolor}{color}}].pixel);}
\DoxyCodeLine{00586\ \ \ movie\_data[x\ +\ y\ *\ xfield]\ =\ (\textcolor{keywordtype}{unsigned}\ char)\mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00587\ \ \ \textcolor{comment}{//\}}}
\DoxyCodeLine{00588\ \}}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \textcolor{comment}{/*void\ X11Graphics::Line\ (\ int\ x1,\ int\ y1,int\ x2,int\ y2,int\ colour\ )}}
\DoxyCodeLine{00591\ \textcolor{comment}{\{}}
\DoxyCodeLine{00592\ \textcolor{comment}{\ \ //\ Usage\ of\ Lines\ in\ movies\ is\ not\ (yet)\ implemented}}
\DoxyCodeLine{00593\ \textcolor{comment}{\ \ if\ (par.graphics)\ \{}}
\DoxyCodeLine{00594\ \textcolor{comment}{\ \ \ \ XSetForeground(display,\ windowGC,\ colour);}}
\DoxyCodeLine{00595\ \textcolor{comment}{\ \ \ \ XDrawLine(display,window,windowGC,x1,y1,x2,y2);}}
\DoxyCodeLine{00596\ \textcolor{comment}{\ \ \ \ XSetForeground(display,\ windowGC,\ foreground);}}
\DoxyCodeLine{00597\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00598\ \textcolor{comment}{\ \ \}*/}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \textcolor{keywordtype}{void}\ X11Graphics::Line(\textcolor{keywordtype}{int}\ x0,\ \textcolor{keywordtype}{int}\ y0,\ \textcolor{keywordtype}{int}\ x1,\ \textcolor{keywordtype}{int}\ y1,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \textcolor{comment}{//\ Bresenham's\ line\ algorithm}}
\DoxyCodeLine{00603\ \ \ \textcolor{comment}{//\ See\ http://www.fact-\/index.com/b/br/bresenham\_s\_line\_algorithm\_c\_code.html}}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \textcolor{comment}{//\ Provided\ to\ supply\ a\ line\ drawing\ algorithm\ that\ allows}}
\DoxyCodeLine{00606\ \ \ \textcolor{comment}{//\ for\ writing\ the\ lines\ to\ a\ picture\ or\ a\ movie}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \textcolor{comment}{//\ (and\ I\ need\ Bresenham\ for\ the\ Lacunae\ measurement\ algorithm,\ and}}
\DoxyCodeLine{00609\ \ \ \textcolor{comment}{//\ want\ to\ see\ whether\ it\ works\ correctly\ :-\/)\ and\ it\ does\ :-\/)!}}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00611\ \ \ \textcolor{keywordtype}{int}\ steep\ =\ 1;}
\DoxyCodeLine{00612\ \ \ \textcolor{keywordtype}{int}\ sx,\ sy;\ \textcolor{comment}{/*\ step\ positive\ or\ negative\ (1\ or\ -\/1)\ */}}
\DoxyCodeLine{00613\ \ \ \textcolor{keywordtype}{int}\ dx,\ dy;\ \textcolor{comment}{/*\ delta\ (difference\ in\ X\ and\ Y\ between\ points)\ */}}
\DoxyCodeLine{00614\ \ \ \textcolor{keywordtype}{int}\ e;}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \textcolor{comment}{/*\ *\ inline\ swap.\ On\ some\ architectures,\ the\ XOR\ trick\ may\ be\ faster\ */}}
\DoxyCodeLine{00617\ \ \ \textcolor{keywordtype}{int}\ tmpswap;}
\DoxyCodeLine{00618\ \textcolor{preprocessor}{\#define\ SWAP(a,\ b)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00619\ \textcolor{preprocessor}{\ \ tmpswap\ =\ a;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00620\ \textcolor{preprocessor}{\ \ a\ =\ b;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00621\ \textcolor{preprocessor}{\ \ b\ =\ tmpswap;}}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ \textcolor{comment}{/*\ *\ optimize\ for\ vertical\ and\ horizontal\ lines\ here\ */}}
\DoxyCodeLine{00624\ \ \ dx\ =\ abs(x1\ -\/\ x0);}
\DoxyCodeLine{00625\ \ \ sx\ =\ ((x1\ -\/\ x0)\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{00626\ \ \ dy\ =\ abs(y1\ -\/\ y0);}
\DoxyCodeLine{00627\ \ \ sy\ =\ ((y1\ -\/\ y0)\ >\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{00628\ \ \ \textcolor{keywordflow}{if}\ (dy\ >\ dx)\ \{}
\DoxyCodeLine{00629\ \ \ \ \ steep\ =\ 0;}
\DoxyCodeLine{00630\ \ \ \ \ SWAP(x0,\ y0);}
\DoxyCodeLine{00631\ \ \ \ \ SWAP(dx,\ dy);}
\DoxyCodeLine{00632\ \ \ \ \ SWAP(sx,\ sy);}
\DoxyCodeLine{00633\ \ \ \}}
\DoxyCodeLine{00634\ \ \ e\ =\ (dy\ <<\ 1)\ -\/\ dx;}
\DoxyCodeLine{00635\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ dx;\ i++)\ \{}
\DoxyCodeLine{00636\ \ \ \ \ \textcolor{keywordflow}{if}\ (steep)\ \{}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \mbox{\hyperlink{class_point}{Point}}(\mbox{\hyperlink{structcolor}{color}},\ x0,\ y0);}
\DoxyCodeLine{00638\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \mbox{\hyperlink{class_point}{Point}}(\mbox{\hyperlink{structcolor}{color}},\ y0,\ x0);}
\DoxyCodeLine{00640\ \ \ \ \ \}}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{while}\ (e\ >=\ 0)\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ y0\ +=\ sy;}
\DoxyCodeLine{00643\ \ \ \ \ \ \ e\ -\/=\ (dx\ <<\ 1);}
\DoxyCodeLine{00644\ \ \ \ \ \}}
\DoxyCodeLine{00645\ \ \ \ \ x0\ +=\ sx;}
\DoxyCodeLine{00646\ \ \ \ \ e\ +=\ (dy\ <<\ 1);}
\DoxyCodeLine{00647\ \ \ \}}
\DoxyCodeLine{00648\ \}}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \textcolor{comment}{//\ Plot\ a\ field\ of\ values\ in\ this\ window,}}
\DoxyCodeLine{00651\ \textcolor{comment}{//\ assuming\ they\ have\ the\ same\ dimensions}}
\DoxyCodeLine{00652\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_x11_graphics_a4ba01ab14685f860af345b4ac17f3339}{X11Graphics::Field}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ **r,\ \textcolor{keywordtype}{int}\ mag)\ \{}
\DoxyCodeLine{00653\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ xfield;\ x++)\ \{}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ yfield;\ y++)\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \mbox{\hyperlink{class_point}{Point}}(r[x\ /\ mag][y\ /\ mag],\ x,\ y);}
\DoxyCodeLine{00656\ \ \ \ \ \}}
\DoxyCodeLine{00657\ \ \ \}}
\DoxyCodeLine{00658\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)}
\DoxyCodeLine{00659\ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_aeafb2bf394ef9dfd3aa9b390d2b21d7a}{EndScene}}();}
\DoxyCodeLine{00660\ \}}
\DoxyCodeLine{00661\ }
\DoxyCodeLine{00662\ \textcolor{keywordtype}{void}\ X11Graphics::InitStore(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00663\ \ \ \textcolor{comment}{//\ \ short\ col[256*3];}}
\DoxyCodeLine{00664\ \ \ \textcolor{keywordtype}{int}\ pars[3];}
\DoxyCodeLine{00665\ \ \ \textcolor{comment}{//\ FILE\ *fpc;}}
\DoxyCodeLine{00666\ \ \ \textcolor{comment}{//\ \ \ if\ (!par.graphics)}}
\DoxyCodeLine{00667\ \ \ \textcolor{comment}{//\ \ \ InitGraphics(xfield,\ yfield);}}
\DoxyCodeLine{00668\ \ \ \textcolor{comment}{//\ \ NB:\ movie\ data\ is\ always\ allocated\ in\ constructor,\ so\ we\ can\ write\ images}}
\DoxyCodeLine{00669\ \ \ film\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)malloc(2\ *\ xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}));}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \textcolor{keywordflow}{if}\ (FileExistsP(movie\_file\_name))\ \{}
\DoxyCodeLine{00672\ \ \ \ \ std::cerr}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Refusing\ to\ overwrite\ movies.\ \(\backslash\)n\ Please\ remove\ or\ rename\ file\ "{}}}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ <<\ movie\_file\_name\ <<\ \textcolor{stringliteral}{"{}\ and\ try\ again.\(\backslash\)n"{}};}
\DoxyCodeLine{00675\ \ \ \ \ exit(1);}
\DoxyCodeLine{00676\ \ \ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \textcolor{comment}{//\ check\ if\ user\ wants\ a\ compressed\ movie}}
\DoxyCodeLine{00679\ \ \ \textcolor{keywordflow}{if}\ (strstr(movie\_file\_name,\ \textcolor{stringliteral}{"{}.gz"{}}))\ \{}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{comment}{//\ yes,\ found\ "{}.gz"{},\ open\ a\ pipe\ to\ gzip}}
\DoxyCodeLine{00681\ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Writing\ compressed\ movie\(\backslash\)n"{}});}
\DoxyCodeLine{00682\ \ \ \ \ \textcolor{keywordtype}{char}\ *command\ =\ (\textcolor{keywordtype}{char}\ *)malloc(1000\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00683\ \ \ \ \ snprintf(command,\ 1000,\ \textcolor{stringliteral}{"{}gzip\ -\/c\ >\ \%s"{}},\ movie\_file\_name);}
\DoxyCodeLine{00684\ \ \ \ \ movie\_fp\ =\ popen(command,\ \textcolor{stringliteral}{"{}w"{}});}
\DoxyCodeLine{00685\ \ \ \ \ free(command);}
\DoxyCodeLine{00686\ \ \ \ \ compressed\_movie\_p\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00687\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00688\ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Writing\ uncompressed\ movie\(\backslash\)n"{}});}
\DoxyCodeLine{00689\ \ \ \ \ movie\_fp\ =\ fopen(movie\_file\_name,\ \textcolor{stringliteral}{"{}w"{}});}
\DoxyCodeLine{00690\ \ \ \ \ compressed\_movie\_p\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00691\ \ \ \}}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \textcolor{keywordflow}{if}\ (movie\_fp\ ==\ NULL)\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \textcolor{keywordtype}{char}\ *error\_message\ =\ (\textcolor{keywordtype}{char}\ *)malloc(200\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00695\ \ \ \ \ snprintf(error\_message,\ 199,\ \textcolor{stringliteral}{"{}In\ X11Graphics::InitStore,\ \%s\(\backslash\)n"{}},}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \ \ \ movie\_file\_name);}
\DoxyCodeLine{00697\ \ \ \ \ perror(error\_message);}
\DoxyCodeLine{00698\ \ \ \ \ free(error\_message);}
\DoxyCodeLine{00699\ \ \ \ \ exit(1);}
\DoxyCodeLine{00700\ \ \ \}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \ \ pars[0]\ =\ (int)yfield;}
\DoxyCodeLine{00703\ \ \ pars[1]\ =\ (int)xfield;}
\DoxyCodeLine{00704\ \ \ printf(\textcolor{stringliteral}{"{}\%d\ \%d\(\backslash\)n"{}},\ yfield,\ xfield);}
\DoxyCodeLine{00705\ \ \ fwrite(pars,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}),\ 2,\ movie\_fp);}
\DoxyCodeLine{00706\ \}}
\DoxyCodeLine{00707\ }
\DoxyCodeLine{00708\ \textcolor{keywordtype}{int}\ X11Graphics::DetectControl()\ \{}
\DoxyCodeLine{00709\ \ \ \textcolor{keywordtype}{int}\ mouse\ =\ 0;}
\DoxyCodeLine{00710\ \ \ \textcolor{keywordflow}{if}\ (par.graphics)\ \{}
\DoxyCodeLine{00711\ \ \ \ \ \textcolor{keywordflow}{while}\ (XEventsQueued(display,\ QueuedAfterFlush)\ >\ 0)\ \{}
\DoxyCodeLine{00712\ \ \ \ \ \ \ XNextEvent(display,\ \&event);}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (event.type)\ \{}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Expose:}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_aeafb2bf394ef9dfd3aa9b390d2b21d7a}{EndScene}}();}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ VisibilityNotify:}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_aeafb2bf394ef9dfd3aa9b390d2b21d7a}{EndScene}}();}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonPress:}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ mouse\ =\ 1;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00726\ \ \ \ \ \}}
\DoxyCodeLine{00727\ \ \ \}}
\DoxyCodeLine{00728\ \ \ \textcolor{keywordflow}{return}\ (mouse);}
\DoxyCodeLine{00729\ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \textcolor{keywordtype}{void}\ X11Graphics::StoreCompPict(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00732\ \ \ \textcolor{keywordtype}{int}\ dist;}
\DoxyCodeLine{00733\ \ \ \textcolor{keywordtype}{long}\ k,\ t\ =\ 0,\ params[5];}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00735\ \ \ \textcolor{keywordflow}{if}\ (store)\ \{}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \ \ dist\ =\ 1;}
\DoxyCodeLine{00738\ \ \ \ \ t\ =\ 0;}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ \ \ \textcolor{keywordflow}{for}\ (k\ =\ 1;\ k\ <\ xfield\ *\ yfield;\ k++)\ \{}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\ ==\ 255\ ||\ (movie\_data)[k]\ !=\ (movie\_data)[k\ -\/\ 1])\ \{}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ film[t++]\ =\ (\textcolor{keywordtype}{unsigned}\ char)dist;}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ film[t++]\ =\ (movie\_data)[k\ -\/\ 1];}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ dist\ =\ 1;}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ ++dist;}
\DoxyCodeLine{00747\ \ \ \ \ \}}
\DoxyCodeLine{00748\ \ \ \ \ film[t++]\ =\ (\textcolor{keywordtype}{unsigned}\ char)dist;}
\DoxyCodeLine{00749\ \ \ \ \ film[t++]\ =\ (movie\_data)[k\ -\/\ 1];}
\DoxyCodeLine{00750\ \ \ \ \ params[0]\ =\ yfield;}
\DoxyCodeLine{00751\ \ \ \ \ params[1]\ =\ xfield;}
\DoxyCodeLine{00752\ \ \ \ \ params[2]\ =\ 0;}
\DoxyCodeLine{00753\ \ \ \ \ params[3]\ =\ 0;}
\DoxyCodeLine{00754\ \ \ \ \ params[4]\ =\ (long)(t\ /\ 2);}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \ \ \ \ \textcolor{comment}{//\ Appending\ to\ a\ file\ using\ open\ is\ very\ unsafe}}
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{comment}{//\ over\ NFS.\ Indeed\ the\ files\ are\ corrupted.}}
\DoxyCodeLine{00758\ \ \ \ \ \textcolor{comment}{//\ It\ is\ safer\ to\ open\ the\ file\ only\ once\ and\ to\ keep\ the}}
\DoxyCodeLine{00759\ \ \ \ \ \textcolor{comment}{//\ file\ descriptor\ in\ a\ static\ int.}}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ \textcolor{comment}{//\ RM.\ 14/05/03}}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{comment}{//\ AND,\ from\ now\ on\ we\ will\ be\ using\ fread\ and\ fwrite.\ Much}}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{comment}{//\ safer.\ (Less\ efficient?)}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \ \ \textcolor{comment}{//\ RM.\ 14/05/03}}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00768\ \ \ \ \ \textcolor{comment}{//\ lseek(fps,0L,2);}}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \ \ fwrite(params,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{long}),\ 5,\ movie\_fp);}
\DoxyCodeLine{00771\ \ \ \ \ fwrite(film,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}),\ t,\ movie\_fp);}
\DoxyCodeLine{00772\ \ \ \ \ fflush(movie\_fp);}
\DoxyCodeLine{00773\ \ \ \ \ \textcolor{comment}{//\ close(fps);}}
\DoxyCodeLine{00774\ \ \ \ \ ++count;}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \textcolor{comment}{//\ testbed}}
\DoxyCodeLine{00779\ \textcolor{comment}{/*}}
\DoxyCodeLine{00780\ \textcolor{comment}{\ \ int\ main(int\ argc,\ char\ *argv[])\ \{}}
\DoxyCodeLine{00781\ \textcolor{comment}{}}
\DoxyCodeLine{00782\ \textcolor{comment}{\ \ int\ s=50;}}
\DoxyCodeLine{00783\ \textcolor{comment}{\ \ X11Graphics\ *g=new\ X11Graphics[100](s,s);}}
\DoxyCodeLine{00784\ \textcolor{comment}{}}
\DoxyCodeLine{00785\ \textcolor{comment}{\ \ sleep(2);}}
\DoxyCodeLine{00786\ \textcolor{comment}{\ \ for\ (int\ c=0;\ c<100;c++)\ \{}}
\DoxyCodeLine{00787\ \textcolor{comment}{\ \ \ \ for\ (int\ i=0;i<s*s;i++)\ \{}}
\DoxyCodeLine{00788\ \textcolor{comment}{\ \ \ \ \ \ //g.Point((int)(sin(((double)i)/5000.)*127)+127,\ i\%s,\ i/s);}}
\DoxyCodeLine{00789\ \textcolor{comment}{\ \ \ \ \ \ g[c].Point(c,\ i\%s,\ i/s);}}
\DoxyCodeLine{00790\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00791\ \textcolor{comment}{\ \ \ \ g[c].EndScene();}}
\DoxyCodeLine{00792\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00793\ \textcolor{comment}{}}
\DoxyCodeLine{00794\ \textcolor{comment}{\ \ while(1);}}
\DoxyCodeLine{00795\ \textcolor{comment}{\ \ delete[]\ g;}}
\DoxyCodeLine{00796\ \textcolor{comment}{\ \ \}*/}}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \textcolor{keywordtype}{int}\ X11Graphics::LineClearP(\textcolor{keywordtype}{char}\ direction,\ \textcolor{keywordtype}{int}\ pos,\ \textcolor{keywordtype}{int}\ cropcol)\ \{}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \textcolor{comment}{/*\ returns\ TRUE\ if\ no\ pixels\ of\ this\ line\ are\ occupied\ by\ a\ cell\ */}}
\DoxyCodeLine{00801\ \ \ \textcolor{keywordtype}{int}\ x,\ y;}
\DoxyCodeLine{00802\ }
\DoxyCodeLine{00803\ \ \ \textcolor{keywordflow}{if}\ (direction\ ==\ \textcolor{charliteral}{'x'})\ \{}
\DoxyCodeLine{00804\ \ \ \ \ \textcolor{keywordflow}{for}\ (y\ =\ 1;\ y\ <\ yfield\ -\/\ 1;\ y++)}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (XGetPixel(image,\ pos,\ y)\ !=\ colors[cropcol].pixel)}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00807\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (direction\ ==\ \textcolor{charliteral}{'y'})\ \{}
\DoxyCodeLine{00808\ \ \ \ \ \textcolor{keywordflow}{for}\ (x\ =\ 1;\ x\ <\ xfield\ -\/\ 1;\ x++)}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (XGetPixel(image,\ x,\ pos)\ !=\ colors[cropcol].pixel)}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00811\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00812\ \ \ \ \ \textcolor{keywordtype}{char}\ *error\ =\ (\textcolor{keywordtype}{char}\ *)malloc(200\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char}));}
\DoxyCodeLine{00813\ \ \ \ \ snprintf(error,\ 199,\ \textcolor{stringliteral}{"{}LineClearP\ error:\ \%c\ is\ an\ unknown\ option."{}},}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \ \ \ \ \ direction);}
\DoxyCodeLine{00815\ \ \ \ \ \textcolor{keywordflow}{throw}(error);}
\DoxyCodeLine{00816\ \ \ \ \ exit(1);}
\DoxyCodeLine{00817\ \ \ \}}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00820\ \}}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \mbox{\hyperlink{structli}{LineType}}\ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{X11Graphics::CropSize}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \textcolor{comment}{/*\ Returns\ the\ upper\ left\ and\ the\ lower\ right\ coordinates}}
\DoxyCodeLine{00825\ \textcolor{comment}{\ \ \ \ \ of\ the\ beast\ */}}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ \mbox{\hyperlink{structli}{LineType}}\ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{CropSize}};}
\DoxyCodeLine{00828\ \ \ \textcolor{keywordtype}{int}\ x,\ y;}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \textcolor{keywordflow}{for}\ (x\ =\ 1;\ x\ <\ xfield\ -\/\ 1;\ x++)}
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{keywordflow}{if}\ (!LineClearP(\textcolor{charliteral}{'x'},\ x))\ \{}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{CropSize}}.x1\ =\ x;}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00834\ \ \ \ \ \}}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \textcolor{keywordflow}{for}\ (y\ =\ 1;\ y\ <\ yfield\ -\/\ 1;\ y++)}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ (!LineClearP(\textcolor{charliteral}{'y'},\ y))\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{CropSize}}.y1\ =\ y;}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00840\ \ \ \ \ \}}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \textcolor{keywordflow}{for}\ (x\ =\ xfield\ -\/\ 1;\ x\ >\ 0;\ x-\/-\/)}
\DoxyCodeLine{00843\ \ \ \ \ \textcolor{keywordflow}{if}\ (!LineClearP(\textcolor{charliteral}{'x'},\ x))\ \{}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{CropSize}}.x2\ =\ x;}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00846\ \ \ \ \ \}}
\DoxyCodeLine{00847\ }
\DoxyCodeLine{00848\ \ \ \textcolor{keywordflow}{for}\ (y\ =\ yfield\ -\/\ 1;\ y\ >\ 0;\ y-\/-\/)}
\DoxyCodeLine{00849\ \ \ \ \ \textcolor{keywordflow}{if}\ (!LineClearP(\textcolor{charliteral}{'y'},\ y))\ \{}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{CropSize}}.y2\ =\ y;}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00852\ \ \ \ \ \}}
\DoxyCodeLine{00853\ }
\DoxyCodeLine{00854\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_x11_graphics_a71f50f8405a9ceae42e4035ab7d41451}{CropSize}};}
\DoxyCodeLine{00855\ \}}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \mbox{\hyperlink{structco}{Coordinate}}\ \mbox{\hyperlink{class_x11_graphics_a934f355d684c9cb35542a6e63ff859be}{X11Graphics::ReplaceBeast}}(\mbox{\hyperlink{structco}{Coordinate}}\ old\_size,\ \mbox{\hyperlink{structco}{Coordinate}}\ new\_size)\ \{}
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ \ \ \mbox{\hyperlink{structco}{Coordinate}}\ offset;}
\DoxyCodeLine{00860\ \ \ \textcolor{keywordtype}{int}\ x,\ y,\ button;}
\DoxyCodeLine{00861\ \ \ Cursor\ hand;}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00863\ \ \ offset.x\ =\ 0;}
\DoxyCodeLine{00864\ \ \ offset.y\ =\ 0;}
\DoxyCodeLine{00865\ }
\DoxyCodeLine{00866\ \ \ \textcolor{comment}{/*\ Change\ name\ of\ window:\ */}}
\DoxyCodeLine{00867\ \ \ \mbox{\hyperlink{class_x11_graphics_adcce6fa1eab8d9a059333e9b1cc8580e}{ChangeTitle}}(\textcolor{stringliteral}{"{}Replace\ beast,\ please."{}});}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \ \ XSetBackground(display,\ windowGC,\ WhitePixel(display,\ screen));}
\DoxyCodeLine{00870\ \ \ XSetForeground(display,\ windowGC,\ BlackPixel(display,\ screen));}
\DoxyCodeLine{00871\ \ \ XClearWindow(display,\ window);}
\DoxyCodeLine{00872\ \ \ XDrawRectangle(display,\ window,\ windowGC,\ offset.x,\ offset.y,\ old\_size.x,}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ old\_size.y);}
\DoxyCodeLine{00874\ \ \ XFlush(display);}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ XSelectInput(display,\ window,\ ButtonPressMask\ |\ PointerMotionMask);}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ hand\ =\ XCreateFontCursor(display,\ XC\_hand1);}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ XGrabPointer(display,\ window,\ TRUE,\ ButtonPressMask\ |\ PointerMotionMask,}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GrabModeAsync,\ GrabModeAsync,\ window,\ hand,\ CurrentTime);}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00883\ \ \ \textcolor{keywordflow}{while}\ ((button\ =\ \mbox{\hyperlink{class_x11_graphics_a2d3f6a3d4b3f0131dbfb9253d51f0ebc}{GetXYCoo}}(\&x,\ \&y))\ !=\ 1)\ \{}
\DoxyCodeLine{00884\ \ \ \ \ \textcolor{keywordflow}{if}\ (button\ ==\ MOTION)\ \{}
\DoxyCodeLine{00885\ }
\DoxyCodeLine{00886\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ +\ old\_size.x\ <\ new\_size.x)}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ offset.x\ =\ x;}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (y\ +\ old\_size.y\ <\ new\_size.y)}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ offset.y\ =\ y;}
\DoxyCodeLine{00890\ }
\DoxyCodeLine{00891\ \ \ \ \ \ \ XClearWindow(display,\ window);}
\DoxyCodeLine{00892\ \ \ \ \ \ \ XDrawRectangle(display,\ window,\ windowGC,\ offset.x,\ offset.y,\ old\_size.x,}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ old\_size.y);}
\DoxyCodeLine{00894\ \ \ \ \ \ \ XFlush(display);}
\DoxyCodeLine{00895\ \ \ \ \ \}}
\DoxyCodeLine{00896\ \ \ \}}
\DoxyCodeLine{00897\ }
\DoxyCodeLine{00898\ \ \ XUngrabPointer(display,\ CurrentTime);}
\DoxyCodeLine{00899\ \ \ \mbox{\hyperlink{class_x11_graphics_a6b8fc3f7590a2f9ae5be1a3917b28cce}{RecoverTitle}}();}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ XSelectInput(display,\ window,}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ButtonPressMask\ |\ KeyPressMask\ |\ ExposureMask\ |}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ StructureNotifyMask);}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \textcolor{keywordflow}{return}\ offset;}
\DoxyCodeLine{00906\ \}}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \textcolor{keywordtype}{void}\ X11Graphics::Resize(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00910\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00911\ \ \ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ shm;}
\DoxyCodeLine{00912\ \ \ \textcolor{keyword}{extern}\ XShmSegmentInfo\ shminfo;}
\DoxyCodeLine{00913\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00914\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ newheight,\ newwidth;}
\DoxyCodeLine{00915\ }
\DoxyCodeLine{00916\ \ \ \textcolor{comment}{//\ some\ dummy\ variables:}}
\DoxyCodeLine{00917\ \ \ \textcolor{keywordtype}{int}\ di;}
\DoxyCodeLine{00918\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ dui;}
\DoxyCodeLine{00919\ \ \ Window\ dw;}
\DoxyCodeLine{00920\ }
\DoxyCodeLine{00921\ \ \ \textcolor{comment}{//\ Get\ rid\ of\ pending\ events}}
\DoxyCodeLine{00922\ \ \ \textcolor{comment}{//\ many\ resize\ events\ are\ generated\ during\ a\ resize}}
\DoxyCodeLine{00923\ \ \ sleep(1);}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \ \ \textcolor{keywordflow}{while}\ (XEventsQueued(display,\ QueuedAfterFlush)\ >\ 0)\ \{}
\DoxyCodeLine{00926\ \ \ \ \ XNextEvent(display,\ \&event);}
\DoxyCodeLine{00927\ \ \ \}}
\DoxyCodeLine{00928\ }
\DoxyCodeLine{00929\ \ \ \textcolor{comment}{//\ \ do\ \ \{}}
\DoxyCodeLine{00930\ \ \ \textcolor{comment}{//\ \ sleep(1);}}
\DoxyCodeLine{00931\ \ \ \textcolor{comment}{//\}\ while\ (GetXYCoo(\&x,\&y)==RESIZE);}}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \textcolor{comment}{//\ Get\ the\ geometry}}
\DoxyCodeLine{00934\ \ \ XGetGeometry(display,\ window,\ \&dw,\ \&di,\ \&di,\ \&newwidth,\ \&newheight,\ \&dui,}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&dui);}
\DoxyCodeLine{00936\ \ \ printf(\textcolor{stringliteral}{"{}\%d\ \%d\(\backslash\)n"{}},\ newwidth,\ newheight);}
\DoxyCodeLine{00937\ }
\DoxyCodeLine{00938\ \ \ \textcolor{keywordtype}{int}\ old\_xfield\ =\ xfield;}
\DoxyCodeLine{00939\ \ \ \textcolor{keywordtype}{int}\ old\_yfield\ =\ yfield;}
\DoxyCodeLine{00940\ \ \ xfield\ =\ newwidth;}
\DoxyCodeLine{00941\ \ \ yfield\ =\ newheight;}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ printf(\textcolor{stringliteral}{"{}New\ xfield:\ \%d,\ yfield:\ \%d\(\backslash\)n"{}},\ xfield,\ yfield);}
\DoxyCodeLine{00944\ }
\DoxyCodeLine{00945\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00946\ \ \ \textcolor{keywordflow}{if}\ (!shm)\ \{}
\DoxyCodeLine{00947\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00948\ }
\DoxyCodeLine{00949\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00950\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ \ \ \textcolor{comment}{//\ Shared\ memory\ was\ used}}
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{comment}{//\ Destroy\ memory\ segment\ and\ XImage}}
\DoxyCodeLine{00954\ }
\DoxyCodeLine{00955\ \ \ \ \ XShmDetach(display,\ \&shminfo);}
\DoxyCodeLine{00956\ \ \ \ \ XDestroyImage(image);}
\DoxyCodeLine{00957\ \ \ \ \ shmdt(shminfo.shmaddr);}
\DoxyCodeLine{00958\ \ \ \ \ shmctl(shminfo.shmid,\ IPC\_RMID,\ 0);}
\DoxyCodeLine{00959\ }
\DoxyCodeLine{00960\ \ \ \ \ \textcolor{comment}{//\ Generate\ new\ segment\ and\ attach\ to\ it}}
\DoxyCodeLine{00961\ \ \ \ \ shminfo.shmid\ =\ shmget(IPC\_PRIVATE,\ image-\/>bytes\_per\_line\ *\ image-\/>height,}
\DoxyCodeLine{00962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IPC\_CREAT\ |\ 0777);}
\DoxyCodeLine{00963\ \ \ \}}
\DoxyCodeLine{00964\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00965\ }
\DoxyCodeLine{00966\ \ \ \textcolor{keywordflow}{if}\ (}
\DoxyCodeLine{00967\ \#ifdef\ USE\_XSHM}
\DoxyCodeLine{00968\ \ \ \ \ \ \ shm\ ||}
\DoxyCodeLine{00969\ \#endif}
\DoxyCodeLine{00970\ \ \ \ \ \ \ image\_data\ !=\ NULL)\ \{}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00972\ \ \ \ \ \textcolor{comment}{//\ New\ Image}}
\DoxyCodeLine{00973\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{00974\ \ \ \ \ \textcolor{keywordflow}{if}\ (!shm)\ \{}
\DoxyCodeLine{00975\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00976\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *new\_image\_data\ =}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})\ *\ depth);}
\DoxyCodeLine{00978\ \ \ \ \ \ \ XImage\ *new\_image\ =\ XCreateImage(display,\ visual,\ depth,\ ZPixmap,\ 0,}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_image\_data,\ xfield,\ yfield,\ 8,\ 0);}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ new\ image}}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ xfield;\ x++)\ \{}
\DoxyCodeLine{00982\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ yfield;\ y++)\ \{}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \ \ XPutPixel(new\_image,\ x,\ y,\ colors[0].pixel);}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00987\ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ old\ image\ into\ new\ image}}
\DoxyCodeLine{00988\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ old\_xfield;\ x++)\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ old\_yfield;\ y++)\ \{}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \ XPutPixel(new\_image,\ x,\ y,\ XGetPixel(image,\ x,\ y));}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00993\ }
\DoxyCodeLine{00994\ \ \ \ \ \ \ \textcolor{comment}{//\ Destroy\ old\ image,\ let\ image\ point\ to\ new\ image}}
\DoxyCodeLine{00995\ \ \ \ \ \ \ XDestroyImage(image);}
\DoxyCodeLine{00996\ \ \ \ \ \ \ image\ =\ new\_image;}
\DoxyCodeLine{00997\ \ \ \ \ \ \ image\_data\ =\ new\_image\_data;}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \mbox{\hyperlink{class_x11_graphics_aeafb2bf394ef9dfd3aa9b390d2b21d7a}{EndScene}}();}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01000\ \textcolor{preprocessor}{\#ifdef\ USE\_XSHM}}
\DoxyCodeLine{01001\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01002\ \ \ \ \ \ \ image\_data\ =\ (\textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{char})\ *\ depth);}
\DoxyCodeLine{01003\ }
\DoxyCodeLine{01004\ \ \ \ \ \ \ image\ =\ XShmCreateImage(display,\ visual,\ depth,\ ZPixmap,\ NULL,\ \&shminfo,}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xfield,\ yfield);}
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01007\ \ \ \ \ \ \ \textcolor{comment}{//\ Allocate\ shared\ memory}}
\DoxyCodeLine{01008\ \ \ \ \ \ \ shminfo.shmid\ =\ shmget(IPC\_PRIVATE,\ image-\/>bytes\_per\_line\ *\ image-\/>height,}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IPC\_CREAT\ |\ 0777);}
\DoxyCodeLine{01010\ }
\DoxyCodeLine{01011\ \ \ \ \ \ \ \textcolor{comment}{//\ Attach\ the\ shared\ memory\ segment\ to\ the\ process}}
\DoxyCodeLine{01012\ \ \ \ \ \ \ shminfo.shmaddr\ =\ image-\/>data\ =\ shmat(shminfo.shmid,\ 0,\ 0);}
\DoxyCodeLine{01013\ }
\DoxyCodeLine{01014\ \ \ \ \ \ \ \textcolor{comment}{//\ Reading\ and\ writing\ to\ the\ shm\ will\ be\ made\ possible}}
\DoxyCodeLine{01015\ \ \ \ \ \ \ shminfo.readOnly\ =\ False;}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01017\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!XShmAttach(display,\ \&shminfo))\ \{}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \ \ printf(}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Warning:\ shared\ memory\ extension\ is\ available,\ but\ allocation\ of\ "{}}}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n\ shared\ memory\ segment\ failed...\ Reverting\ to\ private\ memory.\ "{}}}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}\(\backslash\)n\ This\ is\ not\ problematic,\ but\ it\ will\ be\ a\ bit\ slower.\(\backslash\)n"{}});}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ shm\ =\ 0;}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01025\ }
\DoxyCodeLine{01026\ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Successfully\ prepared\ for\ using\ shared\ memory.\(\backslash\)n"{}});}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01028\ \ \ \ \ \}}
\DoxyCodeLine{01029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01030\ \ \ \}}
\DoxyCodeLine{01031\ \ \ \textcolor{keywordflow}{if}\ (movie\_data)\ \{}
\DoxyCodeLine{01032\ \ \ \ \ \textcolor{comment}{//\ reallocate\ moviedata}}
\DoxyCodeLine{01033\ \ \ \ \ free(movie\_data);}
\DoxyCodeLine{01034\ \ \ \ \ movie\_data\ =}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)malloc(xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}));}
\DoxyCodeLine{01036\ \ \ \}}
\DoxyCodeLine{01037\ \}}
\DoxyCodeLine{01038\ }
\DoxyCodeLine{01039\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_x11_graphics_a82f63efbb9969b69a59c850356d219d3}{X11Graphics::Write}}(\textcolor{keywordtype}{char}\ *fname,\ \textcolor{keywordtype}{int}\ quality)\ \{}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \textcolor{comment}{//\ NB\ quality\ is\ dummy\ parameter\ for\ compatibility\ with}}
\DoxyCodeLine{01042\ \ \ \textcolor{comment}{//\ QtGraphics.\ No\ need\ to\ supply\ it.\ This\ method\ can\ only\ write\ PNG.}}
\DoxyCodeLine{01043\ }
\DoxyCodeLine{01044\ \ \ \textcolor{comment}{//\ based\ on\ code\ borrowed\ from\ Cash2003,\ png.c}}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \textcolor{keywordtype}{string}\ name(fname);}
\DoxyCodeLine{01047\ \ \ \textcolor{keywordflow}{if}\ (name.find(\textcolor{stringliteral}{"{}png"{}})\ ==\ string::npos)\ \{}
\DoxyCodeLine{01048\ \ \ \ \ \textcolor{keywordflow}{throw}(\textcolor{stringliteral}{"{}X11Graphics::Write:\ Sorry,\ only\ PNG\ writing\ is\ implemented"{}});}
\DoxyCodeLine{01049\ \ \ \}}
\DoxyCodeLine{01050\ }
\DoxyCodeLine{01051\ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Writing\ a\ PNG\ picture\(\backslash\)n"{}};}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ \textcolor{keywordtype}{int}\ i,\ j;}
\DoxyCodeLine{01054\ }
\DoxyCodeLine{01055\ \ \ FILE\ *fp;}
\DoxyCodeLine{01056\ \ \ fp\ =\ fopen(fname,\ \textcolor{stringliteral}{"{}wb"{}});}
\DoxyCodeLine{01057\ \ \ \textcolor{keywordflow}{if}\ (fp\ ==\ 0)\ \{}
\DoxyCodeLine{01058\ \ \ \ \ perror(fname);}
\DoxyCodeLine{01059\ \ \ \ \ \textcolor{keywordflow}{throw}(\textcolor{stringliteral}{"{}X11Graphics::Write:\ File\ error\(\backslash\)n"{}});}
\DoxyCodeLine{01060\ \ \ \}}
\DoxyCodeLine{01061\ \ \ png\_structp\ png\_ptr\ =}
\DoxyCodeLine{01062\ \ \ \ \ \ \ png\_create\_write\_struct(PNG\_LIBPNG\_VER\_STRING,\ (png\_voidp)NULL,}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (png\_error\_ptr)NULL,\ (png\_error\_ptr)NULL);}
\DoxyCodeLine{01064\ \ \ png\_infop\ info\_ptr\ =\ png\_create\_info\_struct(png\_ptr);}
\DoxyCodeLine{01065\ \ \ png\_init\_io(png\_ptr,\ fp);}
\DoxyCodeLine{01066\ \ \ png\_set\_IHDR(png\_ptr,\ info\_ptr,\ xfield,\ yfield,\ 8,\ PNG\_COLOR\_TYPE\_RGB,}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PNG\_INTERLACE\_NONE,\ PNG\_COMPRESSION\_TYPE\_BASE,}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PNG\_FILTER\_TYPE\_BASE);}
\DoxyCodeLine{01069\ \ \ png\_write\_info(png\_ptr,\ info\_ptr);}
\DoxyCodeLine{01070\ }
\DoxyCodeLine{01071\ \ \ \textcolor{comment}{//\ data\ to\ hold\ true\ colour\ image}}
\DoxyCodeLine{01072\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *png\_image\ =}
\DoxyCodeLine{01073\ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)malloc(3\ *\ xfield\ *\ yfield\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}));}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01075\ \ \ \textcolor{keywordtype}{int}\ colormap\_size\ =\ 256;}
\DoxyCodeLine{01076\ \ \ \textcolor{keyword}{static}\ XColor\ *png\_colors\ =\ 0;}
\DoxyCodeLine{01077\ \ \ \textcolor{keywordflow}{if}\ (!png\_colors)\ \{}
\DoxyCodeLine{01078\ \ \ \ \ \textcolor{comment}{//\ We\ allocate\ colors\ upon\ the\ first\ call\ only}}
\DoxyCodeLine{01079\ \ \ \ \ \textcolor{comment}{//\ so\ do\ not\ free\ png\_colors!}}
\DoxyCodeLine{01080\ \ \ \ \ \textcolor{keywordflow}{if}\ ((png\_colors\ =\ (XColor\ *)malloc(colormap\_size\ *\ \textcolor{keyword}{sizeof}(XColor)))\ ==}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ NULL)\ \{}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \textcolor{keywordflow}{throw}(\textcolor{stringliteral}{"{}X11Graphics::Write:\ No\ memory\ for\ setting\ up\ colormap"{}});}
\DoxyCodeLine{01083\ \ \ \ \ \}}
\DoxyCodeLine{01084\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ colormap\_size;\ i++)\ \{}
\DoxyCodeLine{01085\ \ \ \ \ \ \ png\_colors[i].pixel\ =\ i;}
\DoxyCodeLine{01086\ \ \ \ \ \ \ png\_colors[i].flags\ =\ DoRed\ |\ DoGreen\ |\ DoBlue;}
\DoxyCodeLine{01087\ \ \ \ \ \}}
\DoxyCodeLine{01088\ \ \ \ \ ReadColorTable(png\_colors);}
\DoxyCodeLine{01089\ \ \ \}}
\DoxyCodeLine{01090\ \ \ \textcolor{keywordflow}{for}\ (j\ =\ 0;\ j\ <\ yfield;\ j++)\ \{}
\DoxyCodeLine{01091\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ xfield;\ i++)\ \{}
\DoxyCodeLine{01092\ \ \ \ \ \ \ XColor\ col;}
\DoxyCodeLine{01093\ \ \ \ \ \ \ col\ =\ png\_colors[movie\_data[i\ +\ j\ *\ xfield]];}
\DoxyCodeLine{01094\ }
\DoxyCodeLine{01095\ \ \ \ \ \ \ png\_image[j\ *\ 3\ *\ xfield\ +\ i\ *\ 3]\ =\ col.red\ /\ 256;}
\DoxyCodeLine{01096\ \ \ \ \ \ \ png\_image[j\ *\ 3\ *\ xfield\ +\ i\ *\ 3\ +\ 1]\ =\ col.green\ /\ 256;}
\DoxyCodeLine{01097\ \ \ \ \ \ \ png\_image[j\ *\ 3\ *\ xfield\ +\ i\ *\ 3\ +\ 2]\ =\ col.blue\ /\ 256;}
\DoxyCodeLine{01098\ \ \ \ \ \}}
\DoxyCodeLine{01099\ \ \ \ \ png\_bytep\ ptr\ =\ png\_image\ +\ j\ *\ 3\ *\ xfield;}
\DoxyCodeLine{01100\ \ \ \ \ png\_write\_rows(png\_ptr,\ \&ptr,\ 1);}
\DoxyCodeLine{01101\ \ \ \}}
\DoxyCodeLine{01102\ \ \ png\_write\_end(png\_ptr,\ info\_ptr);}
\DoxyCodeLine{01103\ \ \ png\_destroy\_write\_struct(\&png\_ptr,\ (png\_infopp)NULL);}
\DoxyCodeLine{01104\ \ \ free(png\_image);}
\DoxyCodeLine{01105\ \ \ fclose(fp);}
\DoxyCodeLine{01106\ \}}

\end{DoxyCode}
